<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Domótica</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.2/mqttws31.min.js" type="text/javascript"></script> <!--PAHO MQTT-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"> <!--ICONOS-->
    <link rel="stylesheet" href="./style.css?3.3" type="text/css">
</head>
</head>
<body>

<!--HIGHCHARTS-->    
<script src="./code/highcharts.js"></script>
<script src="./code/highcharts-more.js"></script>
<script src="./code/modules/solid-gauge.js"></script>
<script src="./code/modules/exporting.js"></script>
<script src="./code/modules/export-data.js"></script>
<script src="./code/modules/accessibility.js"></script>

    
            <!-- BARRA LATERAL-->
            <div class="container">
                <aside>
                    <div class="top">
                        <div class="logo">
                            <img src="./img/logounexpo.png">
                        <h2>Home</h2></div>
                        <div class="close" id="btn-close">
                            <span class="material-icons-round">close</span>
                        </div>
                    </div>
        
                   
                    <div class="sidebar">
                        <a href="#"><span class="material-icons-round">dashboard</span>
                            <h4>Dashboard</h4>
                       </a>
        
                      <a href="#" class="active"><span class="material-icons-round">dashboard_customize</span>
                        <h4>Configuración</h4>
                       </a>
                    </div>
        
        
                </aside>
            
            <!-- FIN BARRA LATERAL -->

            <!-- SECCIÓN PRINCIPAL-->
<main>
    <h1>Dashboard</h1>

   <!-- <div class="date">
        <input type="date">
   </div>-->
   <div><input type="button" onclick="startConnect()" value="Conectar"></div>

    <div class="insights">
        
        <div class="iluminacion">
            <div class="logo1"><span class="material-icons-round">lightbulb</span></div>
            <div class="middle"><div class="left">
                <h3>Iluminación</h3>
                <h1>100%</h1>
            </div>
            <div class="progress">
               <!-- <svg>
                    <circle cx='38' cy='38' r='36'></circle> 
                </svg>-->
             <figure class="highcharts-figure">
                    <div id="container-speed" class="chart-container"></div></figure>
           <!-- <div class="number">
                <p>100%</p>
            </div>-->
            </div>
            </div>
            <small class="text-muted">Sala Conferencia</small>
        </div>

        <div class="temperatura">
            <div class="logo1"><span class="material-icons-round">device_thermostat</span></div>
            <div class="middle"><div class="left">
                <h3>Temperatura</h3>
                <h1>25°C</h1>
            </div>
            </div>
            <small class="text-muted">Sala Conferencia</small>
        </div>
        
        <div class="ventanas">
            <div class="logo1"><span class="material-icons-round">window</span></div>
            <div class="middle"><div class="left">
                <h3>Ventanas</h3>
                <h1>Cerradas</h1>
                <h5 id="inventanas"> Estado ventanas </h5>
            </div>
            <div class="number">
                <p>25°C</p>
            </div>
            </div>
            <small class="text-muted">Sala Conferencia</small>
        </div>



    </div>
</main>
    




</div>





<script type="text/javascript">


function startConnect(){
    clientID = "clientID - "+parseInt(Math.random()*100);
    //host =  "test.mosquitto.org"; 
    //host="91.121.93.94"; //ip mosquitto
    host="192.168.0.102";
    //port = "8081";
    port="8081";
    client = new Paho.MQTT.Client(host,Number(port),clientID);
    
    client.onMessageArrived = onMessageArrived;
    console.log(host + " " + port + " " + clientID);
//    client.onConnectionLost = onConnectionLost;
   
client.connect({
       onSuccess: onConnect
    })
}

function onConnect(){
    topic= "outTopicunexfm";
    console.log("suscrito");
    client.subscribe(topic);
}

var num;
 function onMessageArrived(message){
    //console.log(message.payloadString);
    num = message.payloadString;
    document.getElementById("inventanas").innerHTML = num;
    
}

setInterval(function(){
    console.log(num);
},3000);
    


//CÓDIGO HIGHCHARTS
var gaugeOptions = {
    chart: {
        type: 'solidgauge'
    },

    title: null,

    pane: {
        center: ['50%', '85%'],
        size: '140%',
        startAngle: -90,
        endAngle: 90,
        background: {
            backgroundColor:
                Highcharts.defaultOptions.legend.backgroundColor || '#EEE',
            innerRadius: '60%',
            outerRadius: '100%',
            shape: 'arc'
        }
    },

    exporting: {
        enabled: false
    },

    tooltip: {
        enabled: false
    },

    // the value axis
    yAxis: {
        stops: [
            [0.1, '#55BF3B'], // green
            [0.5, '#DDDF0D'], // yellow
            [0.9, '#DF5353'] // red
        ],
        lineWidth: 0,
        tickWidth: 0,
        minorTickInterval: null,
        tickAmount: 2,
        title: {
            y: -70
        },
        labels: {
            y: 16
        }
    },

    plotOptions: {
        solidgauge: {
            dataLabels: {
                y: 5,
                borderWidth: 0,
                useHTML: true
            }
        }
    }
};

// The speed gauge
var chartSpeed = Highcharts.chart('container-speed', Highcharts.merge(gaugeOptions, {
    yAxis: {
        min: 0,
        max: 200,
        title: {
            text: 'Speed'
        }
    },

    credits: {
        enabled: false
    },

   /* series: [{
        name: 'Speed',
        data: [80],
        dataLabels: {
            format:
                '<div style="text-align:center">' +
                '<span style="font-size:25px">{y}</span><br/>' +
                '<span style="font-size:12px;opacity:0.4">km/h</span>' +
                '</div>'
        },
        tooltip: {
            valueSuffix: ' km/h'
        }
    }]*/

}));



    </script>

</body>
</html>